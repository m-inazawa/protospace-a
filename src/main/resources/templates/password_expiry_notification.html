<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="notification">
    <div class="modal fade" id="pwdExpiryModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true"> <!--data-bs-backdropをstaticにすると、ポップアップの外側をクリックしても閉じられない設定-->
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pwdModalTitle">通知</h5>
                    <button type="button" class="btn-close" id="pwdModalCloseX" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="pwdModalMessage"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="pwdModalCloseBtn" data-bs-dismiss="modal">閉じる</button>
                    <a th:href="@{/user/edit}" class="btn btn-primary">編集する</a> <!--リンク先のパス修正する必要あり？-->
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const status = null; /*[[${session.PWD_STATUS}]]*/  //SuccessHandlerでセットしたセッション値を取得
            if (!status) return;
            //HTMLの中に書いた id="pwdExpiryModal" という箱（モーダル全体）を探してきて、変数 modalElem に代入⇒「Bootstrapのポップアップ機能」として動かせるように初期化している。
            const modalElem = document.getElementById('pwdExpiryModal'); 
            const modal = new bootstrap.Modal(modalElem);
            
            const title = document.getElementById('pwdModalTitle');
            const message = document.getElementById('pwdModalMessage');
            const closeX = document.getElementById('pwdModalCloseX'); //右上の×ボタン
            const closeBtn = document.getElementById('pwdModalCloseBtn'); //下の閉じるボタン

            if (status === 'EXPIRED') {
                title.innerText = "パスワード期限切れ";
                message.innerText = "パスワードの有効期限が切れました。パスワードを変更してください。";
                // 期限切れ時は「閉じる」ボタンと「×」を非表示にして逃げられないようにする
                closeX.style.display = 'none';
                closeBtn.style.display = 'none';
            } else if (status === 'WARNING') {
                title.innerText = "パスワード期限間近";
                message.innerText = "パスワードの有効期限が迫っています。パスワードを変更してください。";
                // 警告時は「閉じる」を表示
                closeX.style.display = 'block';
                closeBtn.style.display = 'block';
            }

            modal.show();
        });
    </script>
</div>
</html>