<div th:fragment="notification">
    <div id="pwdExpiryModal" class="custom-modal">
        <div class="custom-modal-content">
            <button type="button" id="pwdModalCloseX" class="close-x-btn" onclick="closeModal()">×</button>
            <h3 id="pwdModalTitle" style="margin-top: 0;">通知</h3>
            <p id="pwdModalMessage" style="margin: 20px 0; line-height: 1.6;"></p>
            
            <div class="modal-footer">
                <button type="button" id="pwdModalCloseBtn" class="modal-btn btn-secondary" onclick="closeModal()">後で</button>
                <a th:href="@{/users/edit}" class="modal-btn btn-primary">編集画面へ</a>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // 閉じる処理
        function closeModal() {
            document.getElementById('pwdExpiryModal').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Thymeleafでセッションから値を取得（/* */ が重要！）
            const status = /*[[${session.PWD_STATUS}]]*/ '';

            const hasShown = sessionStorage.getItem('pwd_notified');
            
            if ((status === 'EXPIRED' || status === 'WARNING')) {
            
            // WARNINGかつ、すでに表示済みの場合は何もしない
            if (status === 'WARNING' && hasShown) {
                return;
            }
                const modal = document.getElementById('pwdExpiryModal');
                const title = document.getElementById('pwdModalTitle');
                const message = document.getElementById('pwdModalMessage');
                const closeX = document.getElementById('pwdModalCloseX');
                const closeBtn = document.getElementById('pwdModalCloseBtn');

                if (status === 'EXPIRED') {
                    title.innerText = "パスワード期限切れ";
                    message.innerText = "パスワードの有効期限が切れました。安全のため、今すぐ変更してください。";
                    closeX.style.display = 'none';
                    closeBtn.style.display = 'none';
                } else {
                    title.innerText = "パスワード期限間近";
                    message.innerText = "パスワードの有効期限が迫っています。早めの変更をお勧めします。";

                    // ★WARNINGを表示したときだけ「表示済み」フラグを立てる
                    sessionStorage.setItem('pwd_notified', 'true');
                }

                // 表示実行
                modal.style.display = 'block';
            }
        });
    </script>
</div>